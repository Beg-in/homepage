machine:
  environment:
    YARN_VERSION: 1.3.2
    PATH: "${PATH}:${HOME}/.yarn/bin:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  pre:
    - mkdir ~/.yarn-cache
  node:
    version: 9.2.0

dependencies:
  cache_directories:
    - ~/.cache/yarn
  override:
    - yarn
  post:
    - node node_modules/node-sass/scripts/install.js
    - node node_modules/mozjpeg/lib/install.js

test:
  override:
    - /bin/true

deployment:
  production:
    branch: master
    commands:
      - yarn b build:prd
      - find dist/ -type f -exec gzip -9 -n -f "{}" \; -exec mv "{}.gz" "{}" \;
      - aws s3 sync dist/ s3://cdn.beg.in --content-encoding gzip --cache-control "public, max-age=31536000" --exclude index.html --region us-east-2
      - aws s3 cp dist/index.html s3://beg.in --content-encoding gzip --cache-control "public, max-age=300" --region us-east-2

